{% load static %}
<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout Personalizado</title>
    <link rel="stylesheet" href="{% static 'checkout/css/index.css' %}" />

    <!-- SDK de Izipay -->
    <script
      src="https://sandbox-checkout.izipay.pe/payments/v1/js/index.js"
      defer
    ></script>
  </head>
  <body>
    <div class="header-section">
      <div class="header-image"></div>
    </div>

    <div class="main-container">
      <!-- Secci√≥n izquierda: formulario -->
      <div class="left-section">
        <form id="checkout-form" method="POST">
          {% csrf_token %}
          <div class="section-title">Cuenta</div>
          <div class="form-group">
            <input
              type="email"
              name="email"
              placeholder="Correo electr√≥nico"
              required
            />
          </div>

          <div class="section-title">Entrega</div>
          <div class="form-row">
            <div class="form-group">
              <input
                type="text"
                name="first_name"
                placeholder="Nombre"
                required
              />
            </div>
            <div class="form-group">
              <input
                type="text"
                name="last_name"
                placeholder="Apellido"
                required
              />
            </div>
          </div>
          <div class="form-group">
            <input
              type="text"
              name="address1"
              placeholder="Direcci√≥n"
              required
            />
          </div>
          <div class="form-group">
            <input
              type="text"
              name="address2"
              placeholder="Apartamento, suite, etc. (opcional)"
            />
          </div>
          <div class="form-row">
            <div class="form-group">
              <input type="text" name="city" placeholder="Ciudad" required />
            </div>
            <div class="form-group">
              <select name="province" required>
                <option value="">Seleccionar regi√≥n</option>
                <option value="lima">Lima</option>
                <option value="arequipa">Arequipa</option>
                <option value="cusco">Cusco</option>
              </select>
            </div>
            <div class="form-group">
              <input
                type="text"
                name="zip"
                placeholder="C√≥digo postal"
                required
              />
            </div>
          </div>

          <div class="checkbox-group">
            <input type="checkbox" id="save-info" />
            <label for="save-info"
              >Guardar esta informaci√≥n para la pr√≥xima vez</label
            >
          </div>

          <div class="section-title">M√©todo de env√≠o</div>
          <div class="delivery-options">
            <div class="delivery-option selected">
              <input
                type="radio"
                name="shipping_method"
                value="pickup"
                checked
              />
              <div class="delivery-info">
                <div class="delivery-title">Retiro en tienda</div>
              </div>
              <div class="delivery-price">GRATIS</div>
            </div>
          </div>

          <div class="section-title">Pago</div>
          <div class="payment-methods">
            <div class="payment-method">
              <input type="radio" name="payment" value="card" checked />
              <label>Pago seguro con tarjeta, efectivo y transferencia</label>
            </div>
          </div>

          <div class="payment-info">
            üì± <strong>Realiza tu pago f√°cil y r√°pido con Yape o Plin</strong
            ><br />
            üìû Abre tu App de Yape o Plin<br />
            üì± Env√≠a el pago al n√∫mero: <strong>919 499 627</strong><br />
            üè™ Nombre de la empresa: <strong>Kiosk Store S.A.C</strong><br />
            üì∑ Toma captura de tu pantalla üì±<br />
            üìß Env√≠ala a nuestro WhatsApp: <strong>948 288 725</strong
            ><br /><br />
            ‚úÖ Una vez confirmado el pago, procesaremos tu pedido de inmediato.
          </div>

          <button type="submit" class="continue-button">
            Completar pedido
          </button>
        </form>
      </div>

      <!-- Secci√≥n derecha: resumen del pedido -->
      <div class="right-section">
        <div class="order-summary" id="cart"></div>

        <div class="discount-code">
          <input
            type="text"
            class="discount-input"
            placeholder="C√≥digo de descuento"
          />
          <button type="button" class="discount-button">Aplicar</button>
        </div>

        <div class="order-totals">
          <div class="total-line">
            <span>Subtotal</span><span id="subtotal">S/ 0.00</span>
          </div>
          <div class="total-line">
            <span>Env√≠o</span><span id="shipping-cost">GRATIS</span>
          </div>
          <div class="total-line final">
            <span>Total</span><span id="total">PEN S/ 0.00</span>
          </div>
        </div>
      </div>
    </div>
    <!-- Contenedor para el formulario de Izipay -->
    <div
      id="izipay-container"
      style="
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        z-index: 10000;
        display: none;
      "
    >
      <div
        style="
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 20px;
          border-radius: 8px;
          max-width: 500px;
          width: 90%;
        "
      >
        <h3>Procesando pago...</h3>
        <div id="izipay-form-container"></div>
      </div>
    </div>

    <!-- Scripts separados -->
    <script src="{% static 'checkout/js/shopify-handler.js' %}"></script>
    <script src="{% static 'checkout/js/izipay-handler.js' %}"></script>
    <script src="{% static 'checkout/js/ui-manager.js' %}"></script>
    <script src="{% static 'checkout/js/checkout-controller.js' %}"></script>

    <!-- Script de inicializaci√≥n -->
    <script>
      window.addEventListener("load", () => {
        if (typeof Izipay !== "undefined") {
          console.log("‚úÖ SDK de Izipay cargado correctamente");
        } else {
          console.error("‚ùå SDK de Izipay no se pudo cargar");
        }
      });
      
      // Inicializar CheckoutController
      const checkoutController = new CheckoutController();
    </script>
  </body>
</html>
